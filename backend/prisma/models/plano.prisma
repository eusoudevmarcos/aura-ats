model Plano {
  id           String          @id @default(uuid())
  nome         String
  descricao    String?
  preco        Decimal         @db.Decimal(10, 2)
  tipo         TipoPlano       @default(MENSAL) // tipo do plano
  diasGarantia Int?
  limiteUso    Int? // se for por uso: ex. 100 pesquisas
  ativo        Boolean         @default(true)
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  categoria    CategoriaPlano?
  assinaturas  PlanoAssinado[]

  @@schema("Plano")
}

model PlanoAssinado {
  id     String           @id @default(uuid())
  status AssinaturaStatus @default(ATIVA)

  // Recrutamento (CRM)
  dataAssinatura DateTime  @default(now())
  dataExpiracao  DateTime?

  qtdVagas           Int? // Número de selecionadas
  precoPersonalizado Decimal? @db.Decimal(10, 2) // Quando for planos personalizado
  porcentagemMinima  Decimal? @db.Decimal(10, 2) // Perccentual minimo da entrada do "precoTotalPersonalizado" * porcentagemMinima
  observacoes        String?

  // PLATAFORMA (ATS)
  usosDisponiveis Int? // quantas ações ainda pode fazer
  usosConsumidos  Int? // quantas ações foram feitas

  cliente   Cliente @relation(fields: [clienteId], references: [id])
  clienteId String

  plano   Plano  @relation(fields: [planoId], references: [id])
  planoId String

  PlanoUso PlanoUso[]

  @@index([clienteId])
  @@index([planoId])
  @@schema("PlanoAssinado")
}

model PlanoUso {
  id      String   @id @default(uuid())
  acao    String // Ex: "pesquisa_empresa"
  dataUso DateTime @default(now())

  planoAssinatura   PlanoAssinado @relation(fields: [planoAssinaturaId], references: [id])
  planoAssinaturaId String

  @@index([planoAssinaturaId])
  @@schema("PlanoUso")
}
